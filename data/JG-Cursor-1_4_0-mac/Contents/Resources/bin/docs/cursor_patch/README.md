# Cursor Patch 逆向分析报告

## 简介

本文档是对 `bin/cursor_patch` 二进制文件的逆向分析报告。该程序是一个用于修补 Cursor 编辑器的工具，主要功能是绕过 Cursor 的机器ID验证，使得 Cursor 可以在不需要付费订阅的情况下使用全部功能。

## 程序结构

`cursor_patch` 是一个用 Go 语言编写的命令行工具，主要由以下几个部分组成：

1. **main 包**: 包含程序的入口点和主要逻辑流程
2. **cursor_tool_modules 包**: 包含各种功能模块的实现

## 主要功能

程序执行的主要步骤如下：

1. **关闭 Cursor**: 首先关闭所有正在运行的 Cursor 进程
2. **重置机器码**: 重置 Cursor 的机器标识符
3. **禁用自动更新**: 禁用 Cursor 的自动更新功能，防止补丁被覆盖
4. **执行补丁**: 修改 Cursor 的 main.js 文件，替换获取机器ID的相关代码

## 关键函数分析

### `main.main`

主函数是程序的入口点，负责协调整个程序的执行流程。它按顺序执行上述四个步骤，并在执行过程中显示进度信息。每个步骤都有成功和失败的处理逻辑，如果某个步骤失败，程序会立即退出。

### `cursor_tool_modules.PatchMachineID`

这是执行补丁的核心函数，它的主要工作是：

1. 寻找 Cursor 的 main.js 文件
2. 创建备份文件
3. 使用正则表达式替换获取机器ID的相关代码
4. 设置文件权限确保修改成功

关键的替换内容是：
- 将 `async getMachineId(){return ...}` 函数修改为直接返回一个固定值
- 同样修改 Mac 专用的 `getMacMachineID` 函数

## 技术细节

1. **文件路径**: 程序硬编码了 Cursor.app 在 macOS 上的默认安装路径
2. **权限处理**: 程序需要 root 权限运行，并会临时修改文件权限以进行写入
3. **备份机制**: 在修改前会创建原文件的备份，以便在需要时恢复
4. **正则替换**: 使用正则表达式精确定位并替换目标代码，保留原始函数的返回值

## 执行流程图

```
开始
 |
 v
检查是否有 root 权限
 |
 v
步骤 1: 关闭 Cursor 进程
 |
 v
步骤 2: 重置机器码
 |
 v
步骤 3: 禁用自动更新
 |
 v
步骤 4: 检查 Cursor 版本并执行补丁
 |
 v
显示完成通知
 |
 v
结束
```

## 反编译的代码

通过对二进制文件的反编译，我们提取出了程序的主要结构和逻辑。重建后的代码位于以下文件中：

- `docs/cursor_patch/main/main.go`: 主程序
- `docs/cursor_patch/modules/modules.go`: 功能模块

## 结论

`cursor_patch` 是一个专门为绕过 Cursor 编辑器许可验证而设计的工具。它通过修改 Cursor 的 JavaScript 代码，改变了其获取机器ID的方式，使得 Cursor 始终认为当前机器拥有有效的许可证。程序执行过程设计合理，包含了错误处理和进度显示等用户友好的功能。

需要注意的是，这类修改可能违反 Cursor 的使用条款，仅供学习和研究使用。 